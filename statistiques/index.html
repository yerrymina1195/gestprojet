<!DOCTYPE html>


<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>jeemacoder chalenge</title>


        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" 
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
       
<!--  -->
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
         <!--LINK Font Awesone-->
         <link
         rel="stylesheet"
         href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
         integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
         crossorigin="anonymous"
         referrerpolicy="no-referrer"
       />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" 
        integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
        
        <link rel="stylesheet" href="statistiques.css">
    </head>
    <body >  
       
      
              <div class="">
                  <nav class="navbar navbar-expand-lg navbar-light bg-white    fixed-top p-4 fall">
                      <div class="container">
                        <div class="offset-md-3">
                          <form class="d-flex align-items-center border p-2 border-info rounded-3 ">
                               <img src="./image/Icon.png" class="icon" alt="ma photo">
                               <!-- <i class="fa fa-search pt-2 px-3 mx"></i>  -->
                            <input class="form  border-0 me-2" type="search" placeholder="Recherche" aria-label="Search">
                          </form>
                        </div>
                        <div class="d-none d-sm-block">
                          <p>Dieynaba Ly</p>
                      </div>
                      <div class="border-0    flechete d-block d-sm-none     d-flex align-items-center justify-content-end">
                        <a class=" d-flex align-items-center justify-content-center rounded-circle " data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" aria-controls="offcanvasExample">
                          <i class="fas fa-bars"></i>
                        </a>
                       
                      </div>
                      
                    </nav>
              </div>
              <div class="container-fluid ">
                  <div class="row">
                      <div class="col-sm-2 d-sm-block   pt-3 position-relative ">
                          <div class="d-md-none d-flex flex-column test close  bg-white position-fixed    ">
      
                            <div class="d-flex mb-2 p-3 justify-content-center">
                              <a href="../dashbord/dashbord.html" class=" yerry p-2  w-100 text-center   " data-bs-toggle="tooltip"
                              data-bs-placement="right"
                              title="Dashboars">
                              <img src="./image/icon4.png" alt="photo" class="icon5  img-fluid ">
                              </a>
                             
                            </div>
                            <div class="d-flex mb-2 justify-content-center   ">
                            
                             
                              <div class="accordion  " id="accordionExample">
                                  
                                  <div class="accordion-item bg-transparent   border-0">
                                    <h5 class="accordion-header p-3" id="headingTwi">
                                      <button class=" collapsed border-0 bg-transparent merry px-0" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwi" aria-expanded="false" aria-controls="collapseTwo">
                                        <img src="./image/icon0.png" alt="photo" class="icon5 img-fluid w-100  " data-bs-toggle="tooltip"
                                        data-bs-placement="right"
                                        title="USERS">
                                       
                                      </button>
                                    </h5>
                                    <div id="collapseTwi" class="accordion-collapse collapse h-100" aria-labelledby="headingTwi" data-bs-parent="#accordionExample">
                                      <div class="accordion-body d-flex flex-column   p-0">
                                          <a  class=" yerry px-4 py-2  mb-2 " href="../users/eleves/bulletin.html">eleve</a>
                                          <a class=" yerry p-2  mb-2  " href="../users/professeurs/listeEleve.html">professeur</a>
                                          <a class=" yerry p-2   " href="../users/personnelles/index.html">personnels</a>
                                      </div>
                                    </div>
                                  </div>
                                </div>
      
      
                            </div>
                            <div class="d-flex mb-2 justify-content-center">
                              <a href="" class="  yerry p-3 w-100 text-center  " data-bs-toggle="tooltip"
                              data-bs-placement="right"
                              title="comptablité">
                                <img src="./image/icon1.png" alt="photo" class="icon5   img-fluid ">
                                
                            </a>
                            </div>
                            <div class="d-flex mb-2 justify-content-center ">
                              <a href="./index.html" class=" text-center yerry  p-3 w-100" data-bs-toggle="tooltip"
                              data-bs-placement="right"
                              title="statistiques">
                                <img src="./image/icon2.png" alt="photo" class="icon5 img-fluid ">
                                
                              </a>
                            </div>
                            <div class="d-flex  justify-content-center p-3 ">
                              <a href="../pointage/pointage.html" class=" text-center  yerry  p-2 w-100 " data-bs-toggle="tooltip"
                              data-bs-placement="right"
                              title="Pointage">
                                <img src="./image/icon3.png" alt="photo" class="icon5 img-fluid ">
                                
                              </a>
                            </div>
                           
                               
                               
                                
                                <div class="offcanvas offcanvas-start CHANGED" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
                                  <div class="offcanvas-header">
                                    <h5 class="offcanvas-title" id="offcanvasExampleLabel">MENU</h5>
                                    <button type="button" class=" border-0 bg-transparent rounded-circle flechete text-reset" data-bs-dismiss="offcanvas" aria-label="Close">
                                      <i class="fas fa-arrow-left"></i>
                                    </button>
                                  </div>
                                  <div class="offcanvas-body">
                                    <div class="col-12 mina ps-4">
                                      <div class="dash d-flex mb-3 ">
                                        <a href="../dashbord/dashbord.html" class="d-flex align-items-center baba p-2 w-100  ">
                                          <img src="./image/icon4.png" alt="photo" class="icon4 img-fluid ">
                                          <p class=" ms-4 mb-0">Dashboars</p>
                                        </a>
                                      </div>
                                      <div class=" d-flex mb-3 ">
                                      
                                          
                                          <div class="accordion p-2 w-100 " id="accordionExample">
                                              
                                              <div class="accordion-item bg-transparent   border-0">
                                                <h5 class="accordion-header  " id="headingTwa">
                                                  <button class=" collapsed border-0 bg-transparent w-100 d-flex px-0  justify-content-between align-items-center " type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwa" aria-expanded="false" aria-controls="collapseTwa">
                                                    <img src="./image/icon0.png" alt="photo" class="icon4 img-fluid ">
                                                    <p class="mb-0 nam ">Users</p>
                                                    <img src="./image/icon6.png" class="img-fluid " alt="">
                                                  </button>
                                                </h5>
                                                <div id="collapseTwa" class="accordion-collapse collapse  " aria-labelledby="headingTwa" data-bs-parent="#accordionExample">
                                                  <div class="accordion-body  d-flex flex-column px-0">
                                                      <a class="baba  mb-3" href="../users/eleves/bulletin.html">eleve</a>
                                                      <a class="baba mb-3" href="../users/professeurs/listeEleve.html">professeur</a>
                                                      <a class="baba" href="../users/personnelles/index.html">personnels</a>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                      </div>
                                   
                                          <div class=" d-flex    mb-3 ">
                                              <a href="../comptabilité/index.html" class="d-flex align-items-center baba p-2 w-100  ">
                                                  <img src="./image/icon1.png" alt="photo" class="icon4  img-fluid ">
                                                  <p class="ms-4 mb-0 ">Comptabilite</p>
                                              </a>
                                          </div>
                                     
                                      <div class=" d-flex mb-3  ">
                                        <a href="/index.html" class="d-flex align-items-center p-2 w-100 baba   ">
                                          <img src="./image/icon2.png" alt="photo" class="icon4 img-fluid ">
                                          <p class="ms-4 mb-0">Statistique</p>
                                        </a>
                                      </div>
                                      <div class=" d-flex  ">
                                        <a href="../pointage/pointage.html" class="d-flex align-items-center p-2 w-100 baba  ">
                                          <img src="./image/icon3.png" alt="photo" class="icon4 img-fluid ">
                                          <p class="ms-4 mb-0">Pointage</p>
                                        </a>
                                      </div>
      
           
       
                                      
                                      
                                     
                                  </div>
                                   
                                  </div>
                                </div>
                          </div>
                          
                          <div class="container d-none d-md-block px-2 pt-5 py-3 bg-white position-fixed site">
                              <div class="row mx-auto">
                                      
                                      
                                      
                                     
                                    
                                      
                                  <div class="col-12 mina ">
                                      <div class="dash d-flex  mb-3 ">
                                        <a href="../dashbord/dashbord.html" class="d-flex align-items-center baba p-2 w-100  ">
                                          <img src="./image/icon4.png" alt="photo" class="icon4 img-fluid ">
                                          <p class=" ms-4 mb-0">Dashboars</p>
                                        </a>
                                      </div>
                                      <div class=" d-flex mb-3 ">
                                      
                                          
                                          <div class="accordion p-2 w-100 " id="accordionExample">
                                              
                                              <div class="accordion-item bg-transparent   border-0">
                                                <h5 class="accordion-header  p-1 w-100 " id="headingTwo">
                                                  <button class=" collapsed border-0 bg-transparent w-100 d-flex px-0   justify-content align-items-center " type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                                    <img src="./image/icon0.png" alt="photo" class="icon4 img-fluid ">
                                                    <p class="mb-0 nam ms-4  me-5">Users</p>
                                                    <img src="./image/icon6.png" class="img-fluid " alt="">
                                                  </button>
                                                </h5>
                                                <div id="collapseTwo" class="accordion-collapse collapse  " aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                                                  <div class="accordion-body  d-flex flex-column px-0">
                                                      <a class="baba  mb-3" href="../users/eleves/bulletin.html">eleve</a>
                                                      <a class="baba mb-3" href="../users/professeurs/listeEleve.html">professeur</a>
                                                      <a class="baba" href="../users/personnelles/index.html">personnels</a>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                      </div>
                                   
                                          <div class=" d-flex    mb-3 ">
                                              <a href="../comptabilité/index.html" class="d-flex align-items-center baba p-2 w-100  ">
                                                  <img src="./image/icon1.png" alt="photo" class="icon4  img-fluid ">
                                                  <p class="ms-4 mb-0 ">Comptabilite</p>
                                              </a>
                                          </div>
                                     
                                      <div class=" d-flex mb-3  ">
                                        <a href="./index.html" class="d-flex align-items-center p-2 w-100 baba   ">
                                          <img src="./image/icon2.png" alt="photo" class="icon4 img-fluid ">
                                          <p class="ms-4 mb-0">Statistique</p>
                                        </a>
                                      </div>
                                      <div class=" d-flex  ">
                                        <a href="../pointage/pointage.html" class="d-flex align-items-center p-2 w-100 baba  ">
                                          <img src="./image/icon3.png" alt="photo" class="icon4 img-fluid ">
                                          <p class="ms-4 mb-0">Pointage</p>
                                        </a>
                                      </div>
      
           
       
                                      
                                      
                                     
                                  </div>
                              </div>
                          </div>
                      </div>
      
      
                      <!-- c'est dans cette colonne que vous allez mettre votre contenu ou tableau et svp non touche au javascripte -->
                           <!-- Enlevez juste le lorem ipsum et mettez y les travaux effectués s'il ya un probleme suis disponible -->
      
      
      
                      <div class="col-sm-9 offset-sm-1 selection py-5  ">
      
                

                    <p class="fw-bold text-primary">Tableau des statistiques</p>
                  <div class="row  fw-bold bg-light shadow p-3 mb-5 bg-body rounded">
                    <span>Statistique de pointage du jour</span>
                    <div class="col-lg-4">
                    <canvas role="img" id="myChart" ></canvas>
                    </div>
                    <div class="col-lg-4">
                      <canvas role="img" id="myChartProfesseur" ></canvas>
                      </div>
                      <div class="col-lg-4">
                        <canvas role="img" id="myChartAdmin" ></canvas>
                        </div>
                    <!-- <img src="image/pointage1.PNG" alt=""> -->
                  </div>
                    <div class="class row">
                      <div class="col-md-3 col-12">
                        <p class="fw-bold">statistiques des notes du premier semestre</p>
                      </div>
                      <div class="col-md-6 col-12  bg-light shadow  bg-body rounded">
                        <!-- <img src="image/pointage2.PNG" alt=""> -->
                        <span>bakeliste</span>
                        <canvas  height="200" id="myXhart"></canvas>
                        <span>moyenne</span>
                      </div>
                    </div>
                </div>
                   
    
       




        <!-- Optional JavaScript -->

        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
       

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
             <!--KIT.FONT AWESOME-->
    <script
    src="https://kit.fontawesome.com/e5c1f80f7e.js"
    crossorigin="anonymous"
  ></script>
         <script>
          var tooltipTriggerList = [].slice.call(
            document.querySelectorAll('[data-bs-toggle="tooltip"]')
          );
          var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
          });
        </script>

<script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
<script type="module" >
   // Import the functions you need from the SDKs you need
 import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
 import {
   getFirestore,
   setDoc,
   addDoc,
   doc,
   updateDoc,
   deleteDoc,
   getDoc,
   query,
   collection,
   where,
   getDocs,
   onSnapshot,
 } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";
 // TODO: Add SDKs for Firebase products that you want to use
 // https://firebase.google.com/docs/web/setup#available-libraries
 
 // Your web app's Firebase configuration
 
 const firebaseConfig = {
    apiKey: "AIzaSyDn6PYE_7HYD1pATm1S6DBDjsYMigiBQ00",
    authDomain: "pointage-1c893.firebaseapp.com",
    projectId: "pointage-1c893",
    storageBucket: "pointage-1c893.appspot.com",
    messagingSenderId: "551841692809",
    appId: "1:551841692809:web:026a70f6b5880338785a58"
  };
 // Initialize Firebase
 const app = initializeApp(firebaseConfig);
 // Initialize Cloud Firestore and get a reference to the service
 const db = getFirestore(app);
 

 const usersTable = collection(db, "users");
 const pointTable = collection(db, "pointme");

 
 const totalUser = []
 let tre;
 const querySnapshot1 = await getDocs(usersTable);
 querySnapshot1.forEach((doc) => {
   // console.log(doc.id, " => ", doc.data());
   tre = doc.data();
   // console.log(tre);
   tre.id = doc.id;
   
   // console.log(tre);
   totalUser.push(tre);

 });
 console.log(totalUser);
 
 let eleveTotalinusers=totalUser.filter((element) =>{
  return element.statut==="eleve"
 })
 console.log(eleveTotalinusers);

 let adminTotalinusers=totalUser.filter((element) =>{
  return element.statut==="personnel"
 })
 console.log(adminTotalinusers);

 let professeurTotalinusers=totalUser.filter((element) =>{
  return element.statut==="professeur"
 })
 console.log(professeurTotalinusers);
//  let tablEleve = [];



 let currentDate = new Date();
 let day = currentDate.getDate();
 let month = currentDate.getMonth() + 1; // Note : le mois commence à partir de 0
 let year = currentDate.getFullYear();
 let customId = "" + day + (month < 10 ? "0" : "") + month + year;
 console.log(customId);
 
 // Création du document avec l'ID personnalisé
 const docperonnalisé = await doc(pointTable, customId);
 const sousCollectionRef = collection(docperonnalisé, "listedePresence");
 const querySnapshot = await getDocs(sousCollectionRef);
 let chartdepart = [];
 let field;
 querySnapshot.forEach((doc) => {
   // console.log(doc.id, " => ", doc.data());
   field = doc.data();
   // console.log(field);
   field.id = doc.id;
   
   // console.log(field);
   chartdepart.push(field);

 });
//  afficherTableau(chartdepart);
//  console.log(chartdepart);
 let tabEleve = chartdepart.filter((element) =>{
  return element.statut==="eleve"
 })
 console.log(tabEleve);

 let tabAdmin = chartdepart.filter((element) =>{
  return element.statut==="personnel"
 })
 console.log(tabAdmin);

 let tabProfesseur = chartdepart.filter((element) =>{
  return element.statut==="professeur"
 })
 console.log(tabProfesseur);


 let totalEleve = eleveTotalinusers.length;
 let elevePresent = tabEleve.length
 let eleveAbsent = totalEleve - elevePresent;
// -----------------Admin
let totalAdmin = adminTotalinusers.length;
 let adminPresent = tabAdmin.length
 let adminAbsent = totalAdmin - adminPresent;
 console.log(adminAbsent);
//  ---------professeurs
let totalProfesseur = professeurTotalinusers.length;
 let ProfesseurPresent = tabProfesseur.length
 let ProfesseurAbsent = totalProfesseur - ProfesseurPresent;
 console.log(ProfesseurAbsent);

 var xValues = ["Presences","Absences" ];
var yValues = [elevePresent,eleveAbsent];
var barColors = [
  'rgba(54, 162, 235, 1.2)',
  'rgba(255, 99, 132, 1.2)'
 
];

new Chart("myChart", {
  type: "doughnut",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
        plugins: {
            title: {
                display: true,
                text: 'Pointage des eleves'
            }
        }
    }
});

// -------------------
var xValues = ["Presences","Absences" ];
var yValues = [ProfesseurPresent,ProfesseurAbsent];
var barColors = [
  'rgba(54, 162, 235, 1.2)',
  'rgba(255, 99, 132, 1.2)'
 
];

new Chart("myChartProfesseur", {
  type: "doughnut",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
        plugins: {
            title: {
                display: true,
                text: 'Pointage des professeurs'
            }
        }
    }
});
// -------------
var xValues = ["Presences","Absences" ];
var yValues = [adminPresent,adminAbsent];
var barColors = [
  'rgba(54, 162, 235, 1.2)',
  'rgba(255, 99, 132, 1.2)'
 
];

new Chart("myChartAdmin", {
  type: "doughnut",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
        plugins: {
            title: {
                display: true,
                text: 'Pointage du personnel'
            }
        }
    }
});
</script>
<script type="module" src="./js_gestion.js">
 

</script> 

    </body>
</html> 

